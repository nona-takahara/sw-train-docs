---
layout: "@layouts/Layout.astro"
---
# 宗弥急行プロジェクト ATS

本システムは、ゲームソフト Stormworks 向けの民鉄風アドオンセット「宗弥急行プロジェクト」用のシステムである。

> 現在記載されている分について、アルゴリズムとパラメータは確定している。しかしながら、インターフェース部分が変化する可能性がある。インターフェースの変更により、アルゴリズムが追加または変更される場合があるため注意されたい。

## 運転士インターフェース

以下の表示灯・ブザー・入力装置を設置する。Toggle型はフリップスイッチを含む。

本ATS用のすべての保安装置用スイッチは視点を合わせて使用キー（標準ではEキーとQキー）を押すことで操作する方法にせねばならない。保安装置元スイッチは負論理（Offのとき保安装置が起動する論理）での実装を推奨する。

- 保安装置元スイッチ（Toggle型とする。他の保安装置と共用できる。運転中に運転士が容易に操作できない場所に設置し、保安装置起動状態でスポーンするようにすること）
- 保安装置選択装置（他の保安装置を併用する場合に限る）
- 非常運転スイッチ（オンにするのに 0.5 秒以上を要すキースイッチとする。他の保安装置と併用できる）
- 復帰スイッチ（Push型とする）
- 確認スイッチ（Push型とする）
- 保安装置動作正常表示灯（他のATS装置と共用できる）
- 保安装置制動表示灯（任意）
- ATSブザー（連続音もしくは断続音が鳴らせるようにする）

複数の保安装置を併用する場合は、保安装置元スイッチが起動状態にある限り、何らかの保安装置が起動している状態にする必要がある。

### 運転方法

半重複式を全線で採用しており、通常は信号機内方で速度照査が行われる。曲線においても + 5 ～ 15 km/h での連続速度照査を行う（なお、中宗電鉄線内は点照査となっている）。曲線において複数回照査する場合は、最初の照査点に「ATS曲線」標識を設置する。

一部は A点照査 および A-T-S三点照査を行う。

- 停止限界までの減速距離が不足する注意信号に対して、停止限界の 600 m 以上外方にA点を設置し、減速信号速度照査を実施する。
- 警戒信号に対して、停止限界の280 m以上外方にA点を設置し、注意信号速度照査を実施する。
- 絶対信号機等の冒進を許容できない信号機に対して155 m以上外方にA点を設置し警戒信号速度照査、65 m外方にT点を設置しT信号速度照査、30 m外方にS点を設置し、R信号速度照査を実施する。
- 停止位置が停止限界から35 m以内になる場合は、点照査による過走防止を行う。絶対停止点に赤丸S標識を設置する。

また、誘導信号と非設構内においてはATS開放位置でATSを一定速度照査に切り替えて運転する（非常運転を使うか、構内モードを整備するかは現在検討中）。

## 保安装置設計（車上）

### 通信プロトコル

N-TRACS for Stormworksの車両検知用ペインタブルブロックと組み合わせて使用する。

本文書では、先頭車両の前側（前進中は先頭となるが、退行中は進行方向に対して最後尾）のペインタブルブロックに設定したDisplay Nameを`{detector-name}`で参照する。

`{detector-name}`が`TRAIN1`となる場合、`{detector-name}_H1`は`TRAIN1_H1`となる。

#### キーパッド `{detector-name}_H0` (簡易照査モード)
本保安装置は簡易照査に対応する。送信される値はATS速度信号の上限速度である。

簡易照査は、キーパッド `{detector-name}_H0` の値の絶対値の小数点以下を切り捨てた値 \[km/h\] にて照査する共通仕様となっている。

#### キーパッド `{detector-name}_H1` (保安装置判別ID)
絶対値は常に 1 (float)。1 秒以上符号が変化しなかった場合はこのキーパッドの値を 0 と読み替える（アドオンウォッチドッグ）。

本ATSを非常運転ではないモードで起動中に、このキーパッドの値または読み替え値の絶対値が 1 以外になった場合は、E信号を受信したものとして処理する。

#### キーパッド `{detector-name}_H2` (詳細型保安情報)

|値|速度信号名|停止距離 \[m\]|上限速度 \[km/h\]|備考|
|:-:|:-------:|:------------:|:---------------:|:---|
|15|G4|600|132|宗弥急行プロジェクトでは使用しない|
|14|G3|600|122|宗弥急行プロジェクトでは使用しない|
|13|Gh|600|112||
|12|G|600|100||
|11|YGh|280|80||
|10|YG|280|70||
|9|Yh|155|60|宗弥急行プロジェクトでは使用しない|
|8|Y|155|50||
|7|YYt|65|30||
|6|YY|65|30||
|5|Tt|30|18|阪急・阪神・山陽のATSを搭載する車両に限り、上限を 20 km/h とする|
|4|T|30|18|阪急・阪神・山陽のATSを搭載する車両に限り、上限を 20 km/h とする|
|3|R|-|-|ATSによる制動が常用最大制動の場合は常に制動条件を成立させる。<br>ATSによる制動が非常制動の場合は列車速度の絶対値が 1 km/h 程度を上回った場合に制動条件を成立させる|
|2|R|-|-|ATSによる制動が常用最大制動の場合は常に制動条件を成立させる。<br>ATSによる制動が非常制動の場合は列車速度の絶対値が 1 km/h 程度を上回った場合に制動条件を成立させる|
|1|Ea|-|-|常に制動条件を成立させる。他の信号においてATSによる制動が常用最大制動の設定の車両も非常制動とし、復帰操作を必須とする|
|0|E|-|-|常に制動条件を成立させる。他の信号においてATSによる制動が常用最大制動の設定の車両も非常制動とし、復帰操作を必須とする|

### 保安アルゴリズム

太字の言葉は、本ATSの用語である。

#### 通常時のアルゴリズム

保安装置動作正常表示灯を点灯する。

- **ATSによる制動**は常用最大制動か非常制動のうち一方を選択し、以下のように動作する。E信号を除き、ATSによる制動はすべて同じ方法とする。制動出力中は保安装置制動表示灯を点灯する
  - 常用最大制動は、制動条件が成立したら力行を遮断して制動し、制動条件が不成立になるとすぐに力行遮断を終了してブレーキを緩解する
  - 非常制動は、制動条件が成立したら力行を遮断して制動し、制動条件が不成立になっても力行遮断と制動を継続する。制動条件が不成立の状態で、列車速度の絶対値が一定以下（1 km/h 程度以下）のときに**復帰スイッチ**を扱うと力行遮断を終了してブレーキを緩解する
- **照査速度**は、平坦な直線線路において速度信号別に定められた停止距離以内にATSによる制動によって停止できる最高速度と、速度信号別に定められた上限速度の小さい方を採用する
- **制動条件**は、列車速度が照査速度以上になった場合に成立する。このほかにもR信号とE信号の場合は前掲の条件によって制動条件が成立する。R信号とE信号を除き、条件成立中はATSブザーを鳴動する。R信号とE信号により条件成立した場合は、5秒以下だけATSブザーを鳴動する

また、これに加えてT信号照査速度以上の速さで後退した場合は、非常制動・ATSブザーの5秒以下鳴動をおこなう。

#### 確認スイッチ扱いのアルゴリズム

E信号・R信号・T信号・YY信号受信中に確認スイッチを扱うと、E信号・R信号・YY信号の場合はYY信号照査速度、T信号の場合はT信号照査速度を記憶し、実際に受信している信号によらず記憶した速度での連続速度照査を開始する（なお、速度の絶対値が記憶した速度を超過した場合は非常制動・ATSブザーを5秒以下鳴動）。例外としてEa信号受信時はEa信号を優先する。

Y以上の信号、Tt信号、YYt信号のいずれかを受信したら確認扱いを終了し、通常時のアルゴリズムに戻る。

注意喚起のため、一定時間ごとにATSブザーを鳴動することができる。

#### 非常運転スイッチ扱い時のアルゴリズム

受信している速度信号によらず、列車速度の絶対値についてT信号照査速度での照査を行う。速度超過時は非常制動・ATSブザーの5秒以下鳴動をおこなう。

また、注意喚起のため、一定時間ごとにATSブザーを鳴動することができる。
