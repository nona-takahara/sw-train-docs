---
layout: "@layouts/Layout.astro"
---

# NITS Simple Bridge

NITS（ニッツ）は、Stormworks鉄道向けのデイジーチェーン方式の中で最も情報到達時間差が少なくなるよう設計された、コマンドベース総括制御システムである。動力分散システムの車両への適用を推奨する。

- [ワークショップ版 NITS Line Node マイコン](https://steamcommunity.com/sharedfiles/filedetails/?id=3568542650)
    - [NITS Line Nodeマイコン・共通コマンドについて](./NITS.html)
- [ワークショップ版 NITS Simple Bridge マイコン](https://steamcommunity.com/sharedfiles/filedetails/?id=3568542738)

## 利用上の注意

この内容はNITS Line Nodeページにも掲載している。

- 1両に複数の運転室がある車両でも、NITS Line Nodeは1両に1つしか積むことができない
  - NS-TPBからの劣化点の一つである
- A側は「前」を向いて右側、B側は「前」を向いて左側
- 前後選択は、運転操作を行う先頭車両は「前」、もう一方の先頭車両は「後」にする
  - このように設定しないと非常ブレーキが作用する。この仕組みによって編成分離時に全体ブレーキが作用する動作を実現する
  - 単行車が1両で動く場合に困るため、単行車で整備できたと判定される場合は「単行 前後選択成立」を送る
  - 編成の組成作業中や、編成分離状態での非常ブレーキを無効化するためには「前後選択 短絡」を送る

## Simple IF

0x41-0x47の制御情報を生成するのに必要な情報である。

### 入力
|チャンネル |内容     |
|---------- |-------- |
|B6|前後選択前|
|B7|前後選択後|
|B8|単行前後選択成立|
|B9|前後選択短絡|
|||
|N4|ブレーキ力。単位はkPaのはず|
|N5|力行パラメータ|

### 出力
|チャンネル |内容     |
|---------- |-------- |
|B6|内部用(Reject and data is not 0)|
|B7|内部用(Reject)|
|B8|内部用(OK)|
|B9|内部用(0x4X更新)|
|||
|N4|前側車両数|
|N5|後側車両数|
|N6|全車両数|

### 共通
|チャンネル |内容     |
|---------- |-------- |
|B1|非常ブレーキ|
|B2|連絡ブザー|
|B3|故障通報|
|B4|扉A側 開扉状態|
|B5|扉B側 開扉状態|
|B10|パンタグラフ上昇|
|B11|パンタグラフ降下|
|B12|エンジン始動|
|B13|エンジン停止|
|B14|走行用バッテリー起動|
|B15|走行用バッテリー停止|
|B16|前進|
|B17|後退|
|B18|ダイナミックブレーキ(自動)|
|B19|案内表示 起動|
|B20|案内表示 停止|
|B21|チャイム 起動|
|B22|チャイム 停止|
|B23|室内灯 起動|
|B24|室内灯 停止|
|B25|ヒーター 起動|
|B26|ヒーター 停止|
|B27|扉A側 開扉|
|B28|扉A側 閉扉|
|B29|扉B側 開扉|
|B30|扉B側 開扉|
|B32|運転台起動(これがをOnにしないと運転系情報が送られません）|
|||
|N1|ブレーキ|
|N2|力行|
|N3|ダイナミックブレーキ(手動)|


## NITS Extension

信号のルールは各自で決定すること。拡張IDのうちユーザ固有IDの取得には申請が必須（メール・Discord・すとーむすきーのいずれかで、高原のなにコンタクトを取ってください）。

本マイコンではチャンネルごとに設定可能な3モードの通信形態を持つ。

- Integer same: 前後両方の車両に同一の値を送信する。N1-8を数値として読み取り、小数点以下を切り捨てた24bit整数値として他車に送信する
- Binary same: 前後両方の車両に同一の値を送信する。N1-8をComposite to Numberで変換した値として読み取り、B1-B24に相当する値のみ他車に送信する
- Binary separate: 後側の車両にN1-8、前側の車両にN9-16の値を送信する（前ch = 後ch + 8）。値はComposite to Numberで変換した値として読み取り、B1-B24に相当する値のみ他車に送信する

また、読み取り結果は、N1-8とB1-8に、更新するTickだけ情報が流れる形式、N9-16にメモリレジスタで情報を連続化したものを返す。
